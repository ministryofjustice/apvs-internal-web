{% extends "includes/layout.html" %}

{% block page_title %}
{% if serviceName %} {{ serviceName }} {% endif %}
{% endblock %}

{% block content %}

<main id="content" role="main">

  {% include "includes/phase_banner_beta.html" %}

  {% include "includes/validation-error-messages.html" %}

  <form action="/config" method="post">
  <h1 class="table-heading">Configuration</h1>
    <div class="form-group">
      <table class="table">
        <tbody>
          <tr {% if errors['auto-approval-enabled'][0] %} class="warning" {% endif %}>
            <td>
              Auto approval enabled
            </td>
            <td>
              Controls auto approval globally
            </td>
            <td>
              <div class="pull-right">
                <label for="auto-approval-on" class="block-label inline">
                  <input id="auto-approval-on" type="radio" name="AutoApprovalEnabled" value="true" {% if autoApprovalConfig.AutoApprovalEnabled %} checked {% endif %}>
                  <span>On</span>
                </label>
                <label for="auto-approval-off" class="block-label inline no-right-padding">
                  <input id="auto-approval-off" type="radio" name="AutoApprovalEnabled" value="false" {% if not autoApprovalConfig.AutoApprovalEnabled %} checked {% endif %}>
                  <span>Off</span>
                </label>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Rules -->
    <div class="form-group">
      <table class="table">
        <thead>
          <tr>
            <th>Check</th>
            <th>Description</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for key, rule in autoApprovalRulesEnum %}
          <tr>
            <td>
              {{ rule.displayName }}
            </td>
            <td>
              {{ rule.description }}
            </td>
            <td>
              <div class="form-group">
                <label for="check-{{ rule.value }}" class="block-label">
                  <input type="checkbox" id="check-{{ rule.value }}" name="rulesEnabled" value="{{ rule.value }}" class="form-control" {% if rule.value not in rulesDisabled %} checked {% endif %}>
                </label>
              </div>
            </td>
          </tr>
          {% if rule.value == autoApprovalRulesEnum.COST_AND_VARIANCE_EQUAL_OR_LESS_THAN_FIRST_TIME_CLAIM.value and
            rule.value not in rulesDisabled %}

            <tr class="{% if errors['cost-variance-percentage'][0] %} warning {% endif %}">
              <td>
                Auto approval cost variance
              </td>
              <td>
                Controls the cost variance used for auto approval
              </td>
              <td class="percentage-wrapper">
                <span>%</span>
                <input id="cost-variance-percentage"
                  type="text" name="CostVariancePercentage"
                  class="form-control"
                  value="{{ autoApprovalConfig.CostVariancePercentage }}"
                  >
              </td>
            </tr>
          {% elif rule.value == autoApprovalRulesEnum.IS_CLAIM_TOTAL_UNDER_LIMIT.value and
            rule.value not in rulesDisabled %}
            <tr {% if errors['max-claim-total'][0] %} class="warning" {% endif %}>
              <td>
                Max claim total
              </td>
              <td>
                Controls the maximum claim total that can be auto-approved (e.g. 250)
              </td>
              <td class="pound-wrapper">
                <span>Â£</span>
                <input id="max-claim-total" type="text" name="MaxClaimTotal" class="form-control" value="{{ autoApprovalConfig.MaxClaimTotal }}">
              </td>
            </tr>
          {% elif rule.value == autoApprovalRulesEnum.IS_CLAIM_WITHIN_TIME_LIMIT.value and
            rule.value not in rulesDisabled %}
            <tr {% if errors['max-days-after-apvu-visit'][0] %} class="warning" {% endif %}>
              <td>
                Max days after APVU visit
              </td>
              <td>
                Controls the number of days after a visit that a claim can be auto-approved (e.g. 28)
              </td>
              <td>
                <input id="max-days-after-apvu-visit" type="text" name="MaxDaysAfterAPVUVisit" class="form-control" value="{{ autoApprovalConfig.MaxDaysAfterAPVUVisit }}">
                <label>days</label>
              </td>
            </tr>
          {% elif rule.value == autoApprovalRulesEnum.HAS_CLAIMED_LESS_THAN_MAX_TIMES_THIS_YEAR.value and
            rule.value not in rulesDisabled %}
            <tr {% if errors['max-number-of-claims-per-year'][0] %} class="warning" {% endif %}>
              <td>
                Max number of claims per year
              </td>
              <td>
                Controls the maximum number of claims that can be auto-approved per year (e.g. 26)
              </td>
              <td>
                <input id="max-number-of-claims-per-year" type="text" name="MaxNumberOfClaimsPerYear" class="form-control" value="{{ autoApprovalConfig.MaxNumberOfClaimsPerYear }}">
                <label>claims</label>
              </td>
            </tr>
          {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% include "partials/csrf-hidden-input.html" %}

    <input type="submit" class="button" value="Save">
  </form>
  <br>
  <a href="/" class="link">Cancel</a>
  </form>
</main>

{% endblock %}