{% if errors['claim-expense'][0] %}
  <span class="error-message" id="error-message-status-request">{{ errors['claim-expense'][0] }}</span>
{% endif %}

{% if errors['approve-cost'][0] %}
  <span class="error-message" id="error-message-cost-request">{{ errors['approve-cost'][0] }}</span>
{% endif %}

{% if errors['claim-expenses'][0] %}
  <span class="error-message" id="claim-expenses">{{ errors['claim-expenses'][0] }}</span>
{% endif %}

<table class="no-pad-right claim-expense">
  <tbody>
    {% for expense in Expenses %}

      <tr {% if expense['Status'] == 'Select' %} class="warning" {% endif %} {% if expense['Error'] %} class="warning"{% endif %}>
        <td><span class="bold">{{ getDisplayFieldName[expense['ExpenseType']] }} </span>
          <br>
          {{ getClaimExpenseDetailFormatted(expense) }}
          <input id="claim-expense-{{ expense.ClaimExpenseId }}-cost" name="claim-expense-{{ expense.ClaimExpenseId }}-cost" type="hidden" value="{{ formData.claimExpenseData[expense['ClaimExpenseId']].cost or expense['Cost'] }}">
        </td>

        {% if expense.ExpenseType == 'train' and Claim.IsAdvanceClaim %}
          <td>{{ expense['TravelTime'] }}</td>
        {% else %}
          <td class="cost">£{{ displayHelper.toDecimal(expense['Cost']) }}</td>
        {% endif %}

        <td>
          {% if receiptRequiredEnum[expense.ExpenseType] %}
            {% if expense.DocumentStatus == 'uploaded' %}
              <a href="/claim/{{ Claim['ClaimId'] }}/download?claim-document-id={{ expense['ClaimDocumentId'] }}">View receipt</a>

            {% elif expense.DocumentStatus == 'upload-later' %}
              <span class="text-pending">To be uploaded later</span>
              <input type="submit" formaction="/claim/file-upload-redirect/{{ Claim['Reference'] }}/{{ Claim['ClaimId'] }}/RECEIPT?eligibilityId={{ Claim['EligibilityId'] }}&claimExpenseId={{ expense.ClaimExpenseId }}&claimDocumentId={{ expense.ClaimDocumentId }}" value="Add" class="button grey pull-right">

            {% elif expense.DocumentStatus == 'post-later' %}
              <span class="text-pending">To be posted later</span>
              <input type="submit" formaction="/claim/file-upload-redirect/{{ Claim['Reference'] }}/{{ Claim['ClaimId'] }}/RECEIPT?eligibilityId={{ Claim['EligibilityId'] }}&claimExpenseId={{ expense.ClaimExpenseId }}&claimDocumentId={{ expense.ClaimDocumentId }}" value="Add" class="button grey pull-right">

            {% elif expense.ExpenseType == 'train' and Claim.IsAdvanceClaim %}
              <span class="text-pending">Receipt to be uploaded after visit</span>

            {% else %}
              <span class="text-warning">Receipt required</span>

            {% endif %}
          {% endif %}
        </td>

        <td class="claim-expense-response">
          <select id="claim-expense-{{ expense.ClaimExpenseId }}-status" data-id="{{ expense.ClaimExpenseId }}" name="claim-expense-{{ expense.ClaimExpenseId }}-status"
            class="form-control action-select claim-expense-status">
            <option {% if expense['Status'] == undefined %} selected {% endif %}>Select</option>
            {% if expense['Cost'] > 0 %}
            <option 
            {% if formData.claimExpenseData[expense['ClaimExpenseId']].status == claimDecisionEnum.APPROVED or expense['Status'] == claimDecisionEnum.APPROVED %} selected {% endif %} value="{{ claimDecisionEnum.APPROVED }}">Approve</option>
            {% endif %}
            <option {% if formData.claimExpenseData[expense['ClaimExpenseId']].status == claimDecisionEnum.APPROVED_DIFF_AMOUNT or expense['Status'] == claimDecisionEnum.APPROVED_DIFF_AMOUNT %} selected {% endif %} value="{{ claimDecisionEnum.APPROVED_DIFF_AMOUNT }}" >Approve different amount</option>
            <option {% if formData.claimExpenseData[expense['ClaimExpenseId']].status == claimDecisionEnum.REQUEST_INFORMATION or expense['Status'] == claimDecisionEnum.REQUEST_INFORMATION %} selected {% endif %} value="{{ claimDecisionEnum.REQUEST_INFORMATION }}">Request information</option>
            {% if Claim['IsAdvanceClaim'] %}
            <option {% if formData.claimExpenseData[expense['ClaimExpenseId']].status == claimDecisionEnum.MANUALLY_PROCESSED or expense['Status'] == claimDecisionEnum.MANUALLY_PROCESSED %} selected {% endif %} value="{{ claimDecisionEnum.MANUALLY_PROCESSED }}">Process manually</option>
            {% endif %}
            <option {% if formData.claimExpenseData[expense['ClaimExpenseId']].status == claimDecisionEnum.REJECTED or expense['Status'] == claimDecisionEnum.REJECTED  %} selected {% endif %} value="{{ claimDecisionEnum.REJECTED }}">Reject claim</option>
          </select>
          <input id="claim-expense-{{ expense.ClaimExpenseId }}-approvedcost" type="text"
            name="claim-expense-{{ expense.ClaimExpenseId }}-approvedcost" value="{{ formData.claimExpenseData[expense['ClaimExpenseId']].approvedCost or expense['ApprovedCost'] }}"
            class="form-control cost
              {% if (formData.claimExpenseData[expense['ClaimExpenseId']].status == claimDecisionEnum.APPROVED_DIFF_AMOUNT 
                  or formData.claimExpenseData[expense['ClaimExpenseId']].status == claimDecisionEnum.MANUALLY_PROCESSED)
                or (expense['Status'] == claimDecisionEnum.APPROVED_DIFF_AMOUNT 
                  or expense['Status'] == claimDecisionEnum.MANUALLY_PROCESSED) %}
                visibility-visible
              {% else %}
                visibility-hidden
              {% endif %}">
        </td>
      </tr>

    {% endfor %}

    {% for deduction in deductions %}
    <tr>
      <td>
        <span class="bold">{{ displayHelper.getDeductionTypeDisplayName(deduction.DeductionType) }}</span>
        <br>
        Deduction
      </td>
      <td class="deduction">-£{{ displayHelper.toDecimal(deduction['Amount']) }}</td>
      <td></td>
      <td><input type="submit" formaction="/claim/{{ Claim['ClaimId'] }}/remove-deduction" name='remove-deduction-{{ deduction.ClaimDeductionId }}' class='button pull-right grey remove-deduction-button' value='Remove'></td>
    </tr>
    {% endfor %}

    <tr class="no-border">
      <td class="text-left"><h3 class="heading-small space-right">Total Approved Cost:</h3></td>
      <td><h3 class="heading-small claim-expense-approvedCostText">£0.00</h3></td>
      <td></td>
      <td></td>
    </tr>

  </tbody>
</table>
